#if 0
	shc Version 3.9.6, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f ztp.sh 
#endif

static  char data [] = 
#define      msg2_z	19
#define      msg2	((&data[3]))
	"\106\111\004\145\375\074\307\137\047\232\150\217\032\334\076\335"
	"\064\067\024\356\330\020"
#define      chk2_z	19
#define      chk2	((&data[25]))
	"\364\113\320\060\011\370\170\270\335\376\135\223\203\237\332\353"
	"\204\014\164\145\104\300\371\271\313\151"
#define      shll_z	10
#define      shll	((&data[50]))
	"\022\040\050\015\101\217\065\135\271\311\267\046"
#define      opts_z	1
#define      opts	((&data[60]))
	"\235"
#define      lsto_z	1
#define      lsto	((&data[61]))
	"\156"
#define      msg1_z	65
#define      msg1	((&data[76]))
	"\335\166\255\011\275\367\015\256\235\374\243\350\315\235\357\136"
	"\056\237\057\254\043\355\234\372\015\061\064\260\310\210\201\064"
	"\252\063\224\143\203\346\034\260\270\057\060\140\334\157\326\244"
	"\351\313\061\273\261\336\341\313\231\357\364\354\103\077\327\162"
	"\321\277\262\036\232\111\126\145\114\214\017\233\257\116\034"
#define      rlax_z	1
#define      rlax	((&data[141]))
	"\104"
#define      tst2_z	19
#define      tst2	((&data[143]))
	"\362\007\177\232\372\050\342\043\000\041\052\022\150\003\310\236"
	"\050\352\256\001"
#define      tst1_z	22
#define      tst1	((&data[167]))
	"\313\106\147\221\137\206\257\370\041\103\113\227\233\322\147\103"
	"\141\172\263\261\347\055\023\063\306\054\030\073"
#define      text_z	2989
#define      text	((&data[368]))
	"\114\106\160\103\124\036\340\120\301\311\035\137\153\266\145\114"
	"\030\163\077\232\115\221\146\224\371\370\363\065\226\060\347\343"
	"\166\127\046\312\166\007\033\070\320\071\227\074\357\375\211\007"
	"\160\310\242\276\131\011\122\123\002\105\210\231\166\157\174\355"
	"\307\242\270\075\252\323\165\173\014\015\270\374\012\101\004\172"
	"\012\247\071\144\260\213\267\263\321\077\114\107\257\310\064\167"
	"\153\355\265\025\300\053\220\315\070\111\312\102\212\316\275\225"
	"\165\366\371\046\201\260\332\123\360\046\233\240\356\320\027\132"
	"\275\314\157\175\370\000\113\060\111\025\163\324\343\060\151\131"
	"\047\143\200\251\023\132\374\004\201\227\244\157\147\274\312\044"
	"\211\071\242\201\072\355\262\204\002\045\130\346\126\302\100\175"
	"\045\300\361\204\124\123\164\020\115\002\235\272\060\351\105\014"
	"\376\032\131\041\375\336\364\026\150\215\122\201\216\124\126\145"
	"\342\321\174\350\106\205\161\210\233\175\123\025\223\232\334\164"
	"\367\150\254\226\236\227\164\203\202\164\322\364\304\023\055\246"
	"\163\173\207\337\343\003\176\061\054\127\135\335\040\256\124\360"
	"\061\034\024\206\210\351\163\337\050\050\024\226\276\036\222\042"
	"\171\157\042\275\140\272\327\333\150\075\372\044\366\175\101\013"
	"\203\050\037\365\261\004\211\266\202\345\235\326\210\127\331\171"
	"\112\330\135\156\240\126\250\362\320\150\377\067\267\031\321\347"
	"\362\062\324\073\246\173\373\246\255\304\300\002\126\122\116\272"
	"\130\245\147\051\064\235\201\124\006\273\255\323\370\046\162\337"
	"\124\117\311\240\365\271\372\313\337\253\130\057\047\365\040\331"
	"\346\203\325\315\015\011\216\102\070\202\254\133\344\023\113\143"
	"\201\263\164\135\321\073\006\270\136\332\220\147\234\232\210\236"
	"\346\173\134\303\347\014\224\031\004\172\154\066\116\200\121\325"
	"\244\210\033\342\275\250\023\100\157\214\365\157\035\160\121\223"
	"\344\003\071\261\162\072\051\254\275\036\221\154\355\117\114\005"
	"\014\200\325\355\127\247\107\070\020\051\100\136\133\355\002\111"
	"\156\360\175\062\100\176\300\346\305\061\371\344\147\037\112\312"
	"\176\306\236\171\035\224\320\127\043\250\074\010\244\114\343\224"
	"\127\376\202\073\016\223\155\131\114\273\050\210\147\131\063\005"
	"\155\161\032\027\056\273\322\264\141\324\156\367\153\311\054\231"
	"\245\007\250\270\365\162\204\145\071\244\072\323\224\106\027\255"
	"\031\146\152\011\003\232\340\131\143\164\156\067\012\150\303\371"
	"\363\364\034\247\341\317\212\266\175\235\342\103\117\122\331\244"
	"\376\002\310\146\237\160\363\323\141\070\075\205\054\333\324\143"
	"\024\040\000\032\274\111\115\373\065\071\111\042\275\152\153\315"
	"\025\131\052\037\173\372\150\225\141\144\316\040\304\275\023\016"
	"\064\172\070\024\225\225\107\320\354\170\262\013\274\276\147\063"
	"\074\277\327\105\324\120\247\261\205\351\030\023\025\362\125\246"
	"\347\004\051\037\317\046\055\057\224\036\136\151\332\023\246\024"
	"\274\372\362\056\025\130\073\327\275\316\375\311\116\137\265\266"
	"\360\214\023\047\201\311\327\334\222\032\003\316\354\040\027\074"
	"\321\072\110\110\171\032\365\060\141\062\267\107\331\154\316\361"
	"\061\312\160\206\117\076\143\220\164\215\204\265\142\127\366\320"
	"\240\100\056\352\357\167\351\221\202\147\357\001\052\067\064\217"
	"\136\316\365\257\236\121\250\134\056\363\241\272\130\276\052\177"
	"\020\211\032\221\203\007\262\240\270\065\267\336\356\223\136\120"
	"\221\206\313\343\074\107\044\302\156\116\332\102\166\177\362\016"
	"\321\062\312\154\273\135\364\237\225\222\022\320\161\016\276\256"
	"\214\306\233\001\261\207\334\163\201\127\354\167\306\066\370\313"
	"\115\053\032\070\365\001\144\040\323\252\334\223\167\360\365\166"
	"\365\206\352\201\277\102\354\213\302\246\062\372\054\216\353\047"
	"\302\253\217\034\376\061\366\370\023\157\125\167\161\053\165\215"
	"\125\301\114\360\300\264\261\306\026\314\235\210\057\036\335\365"
	"\360\050\110\041\177\130\047\147\346\115\024\135\016\331\263\145"
	"\275\360\313\277\167\056\107\374\265\214\222\206\120\142\007\112"
	"\075\303\040\007\156\016\346\025\022\043\254\024\013\011\273\030"
	"\034\320\004\244\146\277\030\276\146\105\332\330\034\327\004\042"
	"\316\266\053\203\135\261\076\257\220\034\113\363\064\375\205\153"
	"\024\113\130\173\167\137\016\154\331\204\007\363\157\032\023\171"
	"\343\345\254\172\017\256\273\177\117\132\361\266\237\355\275\213"
	"\370\170\333\143\147\303\263\364\073\307\203\104\266\060\260\361"
	"\100\257\216\232\376\114\020\155\003\363\175\110\012\356\153\321"
	"\355\371\113\022\043\032\103\022\025\051\230\237\106\352\153\276"
	"\160\360\373\251\370\163\022\334\041\225\243\076\214\306\146\040"
	"\116\041\021\350\053\365\266\373\252\237\322\270\210\042\254\013"
	"\234\302\340\156\345\100\161\074\016\050\276\001\336\260\153\321"
	"\116\304\220\341\372\221\254\234\210\013\266\253\357\154\142\131"
	"\174\225\354\051\204\355\164\065\060\315\275\030\312\020\016\266"
	"\177\304\364\363\126\123\117\113\341\154\253\160\161\201\131\206"
	"\324\034\325\331\342\240\235\013\143\110\336\165\350\070\312\017"
	"\271\224\273\111\361\130\126\006\221\171\070\263\110\124\104\270"
	"\317\162\360\133\072\274\261\073\226\251\062\313\227\112\350\113"
	"\320\074\272\105\337\375\375\134\073\175\117\362\205\351\011\176"
	"\255\265\141\311\304\127\262\156\154\112\020\171\074\323\037\172"
	"\052\167\005\372\062\263\306\011\324\033\334\161\162\306\345\242"
	"\121\361\351\116\347\153\233\336\100\137\104\035\155\374\043\063"
	"\271\131\376\346\032\030\243\271\266\374\036\016\017\106\146\305"
	"\274\110\035\346\300\317\151\032\207\022\277\307\000\350\320\072"
	"\262\302\300\255\372\014\167\063\012\350\267\046\317\141\221\334"
	"\124\172\353\322\200\222\163\310\106\266\126\147\230\366\246\253"
	"\147\225\306\163\132\104\053\071\172\121\012\305\310\060\315\200"
	"\063\074\245\262\261\371\126\165\325\241\314\066\331\110\224\130"
	"\124\121\122\226\140\227\374\046\051\326\370\374\347\056\061\354"
	"\120\150\376\375\267\012\035\323\153\147\357\101\041\266\135\376"
	"\303\005\361\312\231\220\165\202\050\327\050\347\174\335\313\211"
	"\310\300\355\047\212\354\207\031\027\156\144\327\131\340\026\012"
	"\244\045\276\222\075\275\256\114\237\030\335\343\025\130\275\154"
	"\335\367\001\216\143\017\126\377\144\336\126\115\227\372\123\320"
	"\342\336\076\175\147\115\316\001\262\212\004\170\132\241\214\103"
	"\275\211\056\371\300\122\343\222\213\064\243\135\024\342\271\214"
	"\255\023\373\025\217\370\143\336\166\232\352\340\147\321\375\234"
	"\115\257\315\215\161\073\225\236\314\314\163\324\064\327\254\213"
	"\367\054\337\273\256\202\061\101\357\232\063\244\276\210\370\013"
	"\023\314\225\226\367\145\171\302\367\373\202\113\264\236\256\161"
	"\145\216\352\176\047\144\325\071\055\171\106\320\074\110\211\152"
	"\245\252\007\220\351\146\322\031\253\277\074\053\146\036\017\357"
	"\122\037\352\117\000\276\252\065\137\115\364\202\307\077\104\025"
	"\177\251\303\051\306\160\147\235\374\033\344\105\055\027\247\061"
	"\072\016\160\250\310\350\035\000\223\017\361\157\310\206\332\041"
	"\061\141\147\051\261\247\305\014\210\223\246\322\005\163\076\350"
	"\277\246\341\116\066\363\134\136\021\205\147\013\276\106\270\012"
	"\116\110\336\004\364\153\126\246\017\265\101\135\271\250\077\072"
	"\234\136\327\334\345\137\155\206\043\071\160\233\156\210\100\365"
	"\167\311\366\171\205\251\176\166\204\260\213\165\320\057\175\225"
	"\321\033\001\202\161\100\341\362\145\370\017\047\015\104\106\260"
	"\336\123\256\100\242\020\332\314\164\155\107\135\211\016\312\162"
	"\127\373\224\164\360\151\341\146\207\012\367\335\126\205\227\214"
	"\370\246\006\051\177\171\050\361\261\103\352\263\062\040\150\055"
	"\105\131\246\004\324\154\110\210\266\037\113\232\305\312\340\235"
	"\364\303\306\043\043\065\162\260\021\351\326\272\262\232\125\214"
	"\124\364\360\032\027\242\316\251\310\155\154\073\213\327\045\236"
	"\326\372\370\270\171\050\167\277\124\240\235\240\147\115\245\205"
	"\236\215\145\314\221\342\342\211\053\315\060\075\323\057\233\005"
	"\340\175\352\030\026\256\363\334\225\321\372\174\034\155\357\300"
	"\274\343\314\031\173\275\153\245\030\254\224\166\036\263\374\154"
	"\143\003\031\060\111\205\100\001\137\170\335\362\012\276\274\306"
	"\065\147\007\353\010\062\153\237\357\050\363\351\176\036\157\145"
	"\225\176\277\156\006\373\334\044\144\212\253\161\235\175\144\334"
	"\154\152\126\160\366\065\027\127\044\322\324\222\354\125\135\033"
	"\260\342\270\127\062\113\140\002\054\356\365\133\010\041\343\340"
	"\355\232\156\032\202\151\252\345\266\040\335\171\155\216\260\302"
	"\070\057\052\233\324\014\335\044\166\232\111\067\241\207\005\070"
	"\303\266\313\165\233\145\261\140\034\360\315\076\033\163\344\132"
	"\255\154\211\135\114\110\221\334\005\066\225\376\021\243\136\034"
	"\137\210\366\365\172\140\125\006\147\023\042\341\065\245\110\210"
	"\024\220\037\245\312\066\103\320\267\273\062\016\030\177\050\000"
	"\135\004\061\211\205\062\377\277\362\333\353\103\337\307\143\011"
	"\115\270\040\076\315\310\255\150\244\132\147\133\072\145\155\307"
	"\031\201\317\143\273\040\333\007\224\114\122\077\045\040\317\224"
	"\230\345\136\166\376\357\345\253\005\355\120\377\237\357\261\171"
	"\307\337\254\113\246\361\153\121\316\215\147\203\216\060\110\377"
	"\314\123\077\300\324\212\143\107\235\167\303\135\013\251\116\337"
	"\374\241\072\200\324\075\027\305\345\044\211\365\172\143\301\307"
	"\221\304\014\141\101\140\301\213\150\226\371\254\255\255\140\310"
	"\173\355\142\033\131\056\013\160\244\053\020\265\023\205\353\323"
	"\005\231\150\045\302\006\062\235\007\327\146\376\271\100\054\353"
	"\117\224\004\327\045\041\002\144\072\030\225\033\203\154\340\016"
	"\135\340\022\214\043\306\232\107\043\337\346\131\327\232\346\245"
	"\356\336\237\267\372\034\255\033\205\032\363\267\276\364\022\241"
	"\160\226\000\314\340\203\132\247\275\357\234\027\375\047\036\176"
	"\276\073\050\317\313\200\226\345\033\241\230\003\377\002\204\350"
	"\336\342\235\207\076\342\352\016\137\062\170\142\120\024\371\100"
	"\264\105\025\052\130\037\254\050\072\261\246\220\347\343\324\272"
	"\100\156\363\271\344\340\363\227\043\026\205\357\314\207\054\041"
	"\277\033\304\014\116\345\100\031\247\323\005\321\367\330\344\345"
	"\210\130\120\256\035\232\151\115\110\220\150\005\256\021\163\114"
	"\225\054\326\147\127\276\171\225\050\104\375\054\222\132\205\263"
	"\333\040\365\040\055\137\236\340\212\273\151\022\304\157\125\051"
	"\246\321\162\342\343\235\050\304\161\121\372\066\031\034\000\106"
	"\340\137\154\010\005\152\310\210\021\221\320\330\177\026\277\263"
	"\050\273\253\071\325\103\221\302\330\361\014\116\337\146\364\112"
	"\024\005\352\077\364\216\356\024\340\025\106\110\060\061\350\233"
	"\021\130\314\024\037\112\037\151\364\130\017\047\174\100\347\132"
	"\016\301\006\247\113\051\274\120\172\221\101\264\170\073\347\216"
	"\072\147\254\350\032\267\376\012\302\256\112\107\232\347\371\025"
	"\200\122\144\243\031\303\036\177\321\360\250\332\251\050\253\135"
	"\127\121\360\157\341\125\345\000\145\056\253\267\127\306\232\242"
	"\200\145\251\241\307\255\306\224\023\127\265\073\055\030\317\070"
	"\305\165\221\333\317\033\076\013\317\171\076\016\116\137\370\202"
	"\302\167\313\025\345\333\126\037\270\215\140\316\110\173\025\223"
	"\364\202\344\244\115\077\020\041\213\326\060\316\074\144\245\066"
	"\203\002\050\145\357\112\113\160\126\260\272\037\136\333\241\206"
	"\357\356\165\041\252\167\076\253\133\071\331\215\356\200\156\222"
	"\253\363\264\262\344\015\054\361\305\236\006\014\116\036\126\325"
	"\055\340\150\044\007\216\366\000\333\072\017\236\166\177\116\106"
	"\333\201\377\074\001\043\050\102\213\011\270\121\150\163\345\270"
	"\100\275\107\362\065\063\234\264\304\141\274\006\247\345\244\121"
	"\130\151\224\244\113\212\313\135\303\070\010\254\126\034\374\107"
	"\143\021\141\311\261\312\037\333\001\335\154\376\262\063\377\026"
	"\304\157\173\017\130\204\155\064\106\051\272\263\031\044\253\351"
	"\170\145\330\174\335\026\106\003\365\110\323\045\262\052\214\374"
	"\026\070\177\353\032\174\253\173\204\022\303\116\220\301\272\163"
	"\354\044\355\136\312\341\066\042\122\121\323\374\033\110\173\076"
	"\207\054\354\043\027\314\155\302\243\016\364\151\225\270\367\206"
	"\170\004\354\321\112\321\202\157\140\055\307\204\265\162\056\160"
	"\015\015\256\153\220\300\232\134\017\105\107\350\321\271\146\110"
	"\356\111\371\346\011\346\211\361\156\001\273\314\247\253\246\203"
	"\275\361\212\225\360\211\012\213\305\245\067\064\073\052\177\122"
	"\160\337\371\122\075\376\214\373\035\027\252\026\125\201\350\371"
	"\112\361\214\303\356\242\043\122\134\145\127\075\056\313\031\175"
	"\050\370\304\371\010\232\302\206\352\026\063\122\254\371\016\301"
	"\064\243\071\050\213\136\276\226\122\034\320\136\010\024\034\251"
	"\256\032\304\174\103\022\365\127\217\017\312\355\362\353\374\343"
	"\232\241\166\030\310\035\142\207\257\143\275\241\242\010\207\177"
	"\370\221\332\022\004\367\362\354\111\273\115\310\131\006\030\156"
	"\246\344\077\142\327\231\235\277\056\176\155\037\022\154\177\346"
	"\152\262\174\136\012\363\017\136\233\131\244\171\260\131\205\242"
	"\366\275\037\156\027\043\330\333\303\011\350\270\043\155\306\216"
	"\122\044\352\230\356\074\074\061\145\357\263\325\226\175\124\373"
	"\114\265\075\075\051\171\371\230\025\052\261\062\130\372\102\027"
	"\161\265\314\341\214\201\164\306\016\363\203\346\107\146\155\112"
	"\015\076\000\126\134\277\022\212\342\266\316\156\276\227\042\350"
	"\231\170\240\374\330\122\057\312\042\367\247\071\154\054\100\351"
	"\305\233\164\134\322\344\371\223\126\214\335\025\271\215\005\217"
	"\066\022\253\251\066\205\302\243\206\101\172\031\151\132\136\046"
	"\071\033\043\075\234\273\342\014\042\236\326\107\050\020\352\251"
	"\112\330\133\317\332\200\047\301\327\352\001\124\020\302\173\111"
	"\335\236\207\172\131\151\206\174\010\135\304\060\155\257\332\270"
	"\207\065\207\142\266\257\043\215\232\044\342\252\347\135\363\304"
	"\374\173\077\126\344\305\323\354\043\230\035\221\107\367\112\316"
	"\055\321\060\344\201\124\162\034\170\124\306\140\262\272\044\256"
	"\065\143\005\032\051\330\006\115\160\044\336\267\033\050\206\110"
	"\372\267\055\174\013\237\230\204\363\137\344\246\032\011\125\120"
	"\155\132\152\227\062\161\344\243\225\303\133\260\353\342\371\346"
	"\231\046\143\244\305\374\051\271\134\015\137\166\026\265\306\203"
	"\017\060\032\102\241\377\345\067\302\101\347\256\043\341\225\274"
	"\007\370\141\315\364\212\206\120\227\346\307\256\233\215\061\253"
	"\276\114\355\140\113\323\227\015\024\177\273\067\140\120\364\147"
	"\111\125\064\076\337\273\217\167\242\126\045\076\344\127\352\242"
	"\243\327\003\356\253\232\374\277\031\270\367\172\011\353\341\122"
	"\101\026\220\041\322\037\230\165\166\276\263\132\025\236\375\270"
	"\165\000\247\040\233\243\340\264\134\327\057\145\303\020\270\004"
	"\047\110\045\372\150\276\157\336\174\043\070\222\301\065\112\067"
	"\066\362\130\321\226\070\206\362\020\265\127\324\306\017\331\356"
	"\130\377\350\301\275\130\237\072\173\330\314\075\016\027\165\104"
	"\011\315\026\240\006\234\222\027\122\352\353\030\372\304\006\123"
	"\303\357\024\201\107\264\274\303\214\210\001\233\240\166\340\252"
	"\104\366\112\112\223\335\142\345\307\115\375\302\022\004\025\326"
	"\363\052\127\073\336\023\376\153\234\377\007\074\166\347\346\272"
	"\336\061\004\161\016\147\126\326\264\124\230\307\130\256\235\114"
	"\330\365\207\267\010\205\043\245\205\052\341\373\021\310\265\360"
	"\372\272\141\010\041\270\336\326\015\167\235\146\046\073\262\376"
	"\060\071\266\070\277\331\336\105\003\277\101\025\210\366\005\202"
	"\261\147\213\323\040\152\251\055\341\107\223\007\202\106\006\262"
	"\200\274\353\100\225\311\205\231\211\306\256\022\275\264\225\157"
	"\033\040\102\074\212\354\151\154\064\375\164\266\104\173\151\304"
	"\067\125\004\315\037\212\147\250\120\025\273\016\312\120\175\346"
	"\161\300\042\374\254\214\151\340"
#define      chk1_z	22
#define      chk1	((&data[3883]))
	"\315\130\001\222\220\025\030\322\344\303\165\107\267\303\326\121"
	"\251\265\155\015\136\372\245\232\032\154\247\126\226\136"
#define      pswd_z	256
#define      pswd	((&data[3916]))
	"\036\161\333\332\177\245\053\375\343\016\023\054\042\316\372\076"
	"\040\156\267\176\274\221\145\106\330\364\215\157\217\367\270\277"
	"\363\255\175\153\326\043\131\272\062\154\346\125\073\341\223\134"
	"\117\112\332\014\334\077\122\264\063\337\044\302\327\335\202\313"
	"\212\377\066\141\043\220\033\126\375\002\253\070\343\076\224\062"
	"\211\156\076\145\256\221\032\341\161\076\244\110\033\046\024\245"
	"\046\112\007\111\332\042\240\330\045\113\020\010\212\245\073\024"
	"\024\172\171\302\013\223\244\175\322\110\305\356\157\332\224\225"
	"\044\233\337\377\275\177\327\342\313\350\353\125\216\046\152\243"
	"\241\343\146\254\167\013\051\112\123\357\070\303\311\314\130\356"
	"\147\067\356\045\266\306\010\202\257\364\330\076\032\102\341\273"
	"\045\107\150\235\123\222\347\247\201\037\152\113\354\302\072\123"
	"\372\051\171\261\357\202\063\237\166\013\335\220\115\276\114\163"
	"\006\265\020\131\107\370\000\311\030\153\025\004\055\120\130\050"
	"\171\321\331\150\123\015\007\311\030\344\132\146\243\247\331\252"
	"\135\351\003\244\342\004\156\372\157\204\376\235\324\126\305\115"
	"\050\237\266\174\254\276\106\305\213\234\275\255\231\152\071\002"
	"\112\303\340\342\221\071\343\044\312\072\272\050\260\333\355\317"
	"\115\311\251\315\156\324\312\371\161\210\247\012\362\341\015\075"
	"\244\356\037\066\047\003\132\361\076\025"
#define      date_z	1
#define      date	((&data[4222]))
	"\320"
#define      inlo_z	3
#define      inlo	((&data[4223]))
	"\055\357\216"
#define      xecc_z	15
#define      xecc	((&data[4227]))
	"\077\212\350\067\003\302\307\350\315\012\000\371\337\265\054\256"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
